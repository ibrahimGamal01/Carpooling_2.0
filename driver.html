<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Carpooling UNFCCC</title>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css"> -->
    <!-- <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" /> -->
    <link rel="stylesheet" href="./style.css">

    <link rel="icon" type="image/png" href="src/favicon/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="src/favicon/android-chrome-512x512.png" sizes="512x512">
    <link rel="apple-touch-icon" href="src/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/x-icon" href="src/favicon/favicon.ico">
    <link rel="icon" type="image/png" href="src/favicon/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="src/favicon/favicon-32x32.png" sizes="32x32">

    <!-- Load Leaflet from CDN -->
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

    <!-- original CSS of the routing-machine -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />

    <!-- Load Leaflet from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
        integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
        integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
        crossorigin=""></script>
</head>

<style>
    body{
        background-image: url("src/UN_Campus.jpg");
    }
    .map {
        color: black;
    }
</style>

<body>

    <body>
        <nav class="navv">
            <a href="#" class="logo"><img src="src/unfccc_logo.png" alt="Logo" class="logo-image"></a>
            <div class="bx bx-menu" id="menu-icon"></div>

            <ul class="nav-list">
                <li><a href="Home.html">Home</a></li>
                <li><a href="passenger.html">Passenger</a></li>
                <li><a href="driver.html">Driver</a></li>
                <li><a href="map.html">Map</a></li>
            </ul>
        </nav>

        <section class="hero">
            <div class="sidebar-container">
                <img src="src/car-svgrepo-com.svg" alt="Car Icon" class="car-icon">
                <div class="sidebar">
                    <h1 style="font-family: 'Arial', sans-serif; font-size: 45px;"> Create a Ride</h1>
                    <!-- <p style="font-family: 'Arial', sans-serif; font-size: 10px;">Fill out the form below to create a ride.</p> -->
                    <form id="create-ride-form" action="php/create_ride.php" method="POST">
                        <!-- <input type="hidden" name="driver" value="Driver Name"> -->

                        <label for="pickupLocation" style="font-family: 'Arial', sans-serif; font-size: 20px;">Pickup
                            Location</label>
                        <input type="text" id="pickupLocation" name="pickupLocation"
                            placeholder="Enter pickup location">

                        <label for="dropoffLocation" style="font-family: 'Arial', sans-serif; font-size: 20px;">Drop-off
                            Location</label>
                        <input type="text" id="dropoffLocation" name="dropoffLocation"
                            placeholder="Enter drop-off location">

                        <label for="seats" style="font-family: 'Arial', sans-serif; font-size: 20px;">Seats</label>
                        <input type="number" id="seats" name="seats" placeholder="Number of Available Seats" min="1">

                        <button type="submit" class="btn">Create Ride</button>
                    </form>
                </div>
            </div>
        </section>

        <div class="rides-container">
            <div class="ride-details" id="ride-details"></div>
        </div>
        <div class="main-content">
            <div id="map" class="map"></div>
            <!-- <div id="ride-details"></div> -->
        </div>
    </body>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.min.js"></script>
    <script>
        let menu = document.querySelector('#menu-icon');
        let navList = document.querySelector('.nav-list');

        menu.onclick = () => {
            menu.classList.toggle('bx-x');
            navList.classList.toggle('open');
        }

        const createRideForm = document.getElementById('create-ride-form');
        createRideForm.addEventListener('submit', event => {
            event.preventDefault();
            createRide();
            // updateMapCoordinates(pickupLocation, dropoffLocation);
        });

        // function updateMapCoordinates(pickupLocation, dropoffLocation) {
        //     // Remove existing routing control if it exists
        //     if (routingControl) {
        //         map.removeControl(routingControl);
        //     }

        //     // Define new pickup and dropoff coordinates
        //     const pickupCoordinates = getCoordinates(pickupLocation);
        //     const dropoffCoordinates = getCoordinates(dropoffLocation);

        //     // Update the routing control with new waypoints
        //     routingControl = L.Routing.control({
        //         waypoints: [
        //             L.latLng(pickupCoordinates.latitude, pickupCoordinates.longitude),
        //             L.latLng(dropoffCoordinates.latitude, dropoffCoordinates.longitude)
        //         ],
        //         routeWhileDragging: true,
        //         routeDragInterval: 500,
        //         collapsible: true,
        //         reverseWaypoints: false,
        //         showAlternatives: false,
        //         createMarker: function (i, wp, nWps) {
        //             switch (i) {
        //                 case 0:
        //                     return L.marker(wp.latLng, {
        //                         icon: svgpin_Icon,
        //                         draggable: true,
        //                     }).bindPopup("<b>" + "Origin" + "</b>");
        //                 case nWps - 1:
        //                     return L.marker(wp.latLng, {
        //                         icon: svgpin_Icon2,
        //                         draggable: true,
        //                     }).bindPopup("<b>" + "Destination" + "</b>");
        //                 default:
        //                     return L.marker(wp.latLng, {
        //                         icon: svgpin_Icon3,
        //                         draggable: true,
        //                     }).bindPopup("<b>" + "Waypoint" + "</b>");
        //             }
        //         },
        //     }).addTo(map);
        // }


        function createRide() {
            const pickupLocation = document.getElementById('pickupLocation').value;
            const dropoffLocation = document.getElementById('dropoffLocation').value;
            const seats = document.getElementById('seats').value;

            // Send a request to the server to create a new ride
            fetch('php/create_ride.php', {
                method: 'POST',
                body: JSON.stringify({ pickupLocation, dropoffLocation, seats }), // Updated object keys
            })
                .then(response => response.json())
                .then(data => {
                    // Show the ride details on success
                    const rideDetails = document.getElementById('ride-details');
                    rideDetails.innerHTML = '';

                    if (data && data.rideId) {
                        const rideDiv = document.createElement('div');
                        rideDiv.classList.add('ride-box-container');

                        const driverInfo = document.createElement('p');
                        driverInfo.classList.add('driver');
                        // driverInfo.textContent = `Driver: ${data.driverName}`;
                        rideDiv.appendChild(driverInfo);

                        const seatsInfo = document.createElement('p');
                        seatsInfo.classList.add('seats');
                        seatsInfo.textContent = `Seats: ${data.seats}`;
                        rideDiv.appendChild(seatsInfo);

                        const pickupInfo = document.createElement('p');
                        pickupInfo.textContent = `Pickup: ${data.pickup}`;
                        rideDiv.appendChild(pickupInfo);

                        const dropoffInfo = document.createElement('p');
                        dropoffInfo.textContent = `Dropoff: ${data.dropoff}`;
                        rideDiv.appendChild(dropoffInfo);

                        // Display the passenger list
                        if (data.passengers && data.passengers.length > 0) {
                            const passengersDiv = document.createElement('div');
                            passengersDiv.classList.add('passengers-box');

                            const passengersHeading = document.createElement('h2');
                            passengersHeading.textContent = 'Passengers:';
                            passengersDiv.appendChild(passengersHeading);

                            const passengersList = document.createElement('ul');
                            data.passengers.forEach(passenger => {
                                const passengerItem = document.createElement('li');
                                passengerItem.textContent = `Name: ${passenger.name}, ID: ${passenger.id}`;
                                passengersList.appendChild(passengerItem);
                            });
                            passengersDiv.appendChild(passengersList);

                            rideDiv.appendChild(passengersDiv);
                        }

                        rideDetails.appendChild(rideDiv);
                    } else {
                        const noRidesMsg = document.createElement('p');
                        noRidesMsg.textContent = 'Failed to create a ride.';
                        rideDetails.appendChild(noRidesMsg);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    </script>
    <script>
        //This is the center of the map
        const cntr_loc = L.latLng(50.704129514100735, 7.16153100070237);

        //This is the location of the marker
        const orig_loc = L.latLng(50.7322, 7.0961);
        const dest_loc = L.latLng(50.718815, 7.125222);

        var zoom = 16;

        //This is the map
        var map = L.map("map", {
            preferCanvas: false,
        }).setView(cntr_loc, zoom);

        //This map tiles is simple and no hassles.
        L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            attribution: "Map data &copy; OpenStreetMap contributors",
        }).addTo(map);

        //This is the marker
        const checkmk = `<svg width="24" height="24" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg"><path stroke="black" stroke-width="1.5%" opacity="0.8" fill="brown" d="M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1Z"></path></svg>`;

        function checkmk_mk(color) {
            // assume checkmk has `brown` only 1 place
            return checkmk.replace(/brown/g, color);
        }

        const svgpin_Url = encodeURI("data:image/svg+xml;utf-8," + checkmk_mk("red"));
        const svgpin_Url2 = encodeURI(
            "data:image/svg+xml;utf-8," + checkmk_mk("green")
        );
        const svgpin_Url3 = encodeURI(
            "data:image/svg+xml;utf-8," + checkmk_mk("black")
        );

        const svgpin_Icon = L.icon({
            iconUrl: svgpin_Url,
            iconSize: [24, 24],
            iconAnchor: [12, 24],
            popupAnchor: [0, -22],
        });
        const svgpin_Icon2 = L.icon({
            iconUrl: svgpin_Url2,
            iconSize: [24, 24],
            iconAnchor: [12, 24],
            popupAnchor: [0, -22],
        });
        const svgpin_Icon3 = L.icon({
            iconUrl: svgpin_Url3,
            iconSize: [24, 24],
            iconAnchor: [12, 24],
            popupAnchor: [0, -22],
        });

        /* Start routing control  */
        function begin_routing() {
            L.Routing.control({
                waypoints: [
                    orig_loc,
                    dest_loc,
                    //L.latLng(14.1688, 100.2918),
                    //L.latLng(13.7042, 100.6032)
                ],
                routeWhileDragging: true,
                routeDragInterval: 500,
                collapsible: true, // hide/show panel routing
                reverseWaypoints: false,
                showAlternatives: false,
                createMarker: function (i, wp, nWps) {
                    switch (i) {
                        case 0:
                            return L.marker(wp.latLng, {
                                icon: svgpin_Icon,
                                draggable: true,
                            }).bindPopup("<b>" + "Origin" + "</b>");
                        case nWps - 1:
                            return L.marker(wp.latLng, {
                                icon: svgpin_Icon2,
                                draggable: true,
                            }).bindPopup("<b>" + "Destination" + "</b>");
                        default:
                            return L.marker(wp.latLng, {
                                icon: svgpin_Icon3,
                                draggable: true,
                            }).bindPopup("<b>" + "Waypoint" + "</b>");
                    }
                },
            }).addTo(map);
        }

        begin_routing();
    </script>
</body>

</html>